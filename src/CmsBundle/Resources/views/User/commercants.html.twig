{% extends 'base.html.twig' %}

{% block body %}
    <div class="row">
        {% if is_granted("ROLE_SUPER_ADMIN") %}
            <div class="edit_admin">
                <a class="btn btn-default edit_admin" href="{{ path('commercant_new') }}">Ajouter un nouveau commerçant</a>
                <a class="btn btn-default edit_admin" href="{{ path('commercant_index') }}">Administrer les commerçants</a>
            </div>
        {% endif %}
    </div>

    <div id="map"></div>

{% endblock %}

{% block javascripts %}

    {{ parent() }}
    <script>

        var map;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 48.407711, lng: 2.700231 },
                zoom: 15
            });
            codeAddress();
}
       // function initialize() {

        function codeAddress() {
            var imageMarqueur = {
                url: "{{ asset('bundles/cms/images/MapMarker_PushPin1__Azure.png') }}",
                size: new google.maps.Size(25, 40),
                anchor: new google.maps.Point(0, 20)
            };
            {% for commercant in commercants %}
                var lat = {{ commercant.lat }};
                var lng = {{ commercant.lng }};

                var marker = new google.maps.Marker({
                    map: map,
                    icon: imageMarqueur,
                    position: {lat: lat, lng: lng }
                });

                var description =
                        '<div id="iw_container">'+
                            '<div class="iw_title">{{ commercant.nom }}</div>'+
                            '<div class="iw_content">'+
                                '<p>{{ commercant.adresse }}</p>'+
                                '<a href="{{ commercant.lien | external_link }}" target="_blank" class="read-more">En savoir plus</a>'+
                             '</div>'+
                        '</div>';
            
                var infoWindow = new google.maps.InfoWindow();
                //Attach click event to the marker.
                (function (marker, description) {
                    google.maps.event.addListener(marker, "click", function (e) {
                        //Wrap the content inside an HTML DIV in order to set height and width of InfoWindow.
                        infoWindow.setContent(description);
                        infoWindow.open(map, marker);
                    });

                    google.maps.event.addListener(map, 'click', function() {
                        infoWindow.close();
                    });
                })(marker, description);

            {% endfor %}

        }

    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAa232Ch8q6OuI0qAkNV4s36dSJKSCaswc&callback=initMap" async defer></script>

{% endblock %}
