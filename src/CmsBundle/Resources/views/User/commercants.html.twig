{% extends 'base.html.twig' %}

{% block body %}
    {% if is_granted("ROLE_SUPER_ADMIN") %}
        <div class="container">
            <div class="row">
                <div class="wrong_commercant">
                    <h3>L'adresse des commerçants suivant est mal renseignée, veuillez la corriger</h3>
                    <table>
                        <table id="example" class="display" cellspacing="0" width="100%">
                            <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Adresse</th>
                                <th>Codepostal</th>
                                <th>Ville</th>
                                <th>Lien</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for commercant in wrong_commercant %}
                                <tr>
                                    <td>{{ commercant.nom }}</td>
                                    <td>{{ commercant.adresse }}</td>
                                    <td>{{ commercant.code }}</td>
                                    <td>{{ commercant.ville }}</td>
                                    <td>
                                        {% if commercant.lien != null %}
                                            <a href="{{ commercant.lien }}">WebSite</a>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <ul>
                                            <li>
                                                <a href="{{ path('commercant_edit', { 'id': commercant.id }) }}">Editer</a>
                                            </li>
                                            <li>
                                                <a href="{{ path('commercant_delete', { 'id': commercant.id }) }}">Supprimer</a>
                                            </li>
                                        </ul>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </table>
                </div>

            </div>
            <div class="row">
                <div class="edit_admin">
                    <a class="btn btn-default edit_admin" href="{{ path('commercant_new') }}">Ajouter un nouveau commerçant</a>
                    <a class="btn btn-default edit_admin" href="{{ path('commercant_index') }}">Administrer les commerçants</a>
                </div>
            </div>
        </div>
    {% endif %}

    <div id="map"></div>



{% endblock %}

{% block javascripts %}

    {{ parent() }}
    <script>

        var map;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 48.407711, lng: 2.700231 },
                zoom: 15
            });
            codeAddress();
}
       // function initialize() {

        function codeAddress() {
            var imageMarqueur = {
                url: "{{ asset('bundles/cms/images/MapMarker_PushPin1__Azure.png') }}",
                size: new google.maps.Size(25, 40),
                anchor: new google.maps.Point(0, 20)
            };
            {% for commercant in commercants %}

                var lat = {{ commercant.lat }};
                var lng = {{ commercant.lng }};

                var marker = new google.maps.Marker({
                    map: map,
                    icon: imageMarqueur,
                    position: {lat: lat, lng: lng }
                });

                var description =
                        '<div id="iw_container">'+
                            '<div class="iw_title">{{ commercant.nom }}</div>'+
                            '<div class="iw_content">'+
                                '<p>{{ commercant.adresse }}</p>'+
                                '<a href="{{ commercant.lien | external_link }}" target="_blank" class="read-more">En savoir plus</a>'+
                             '</div>'+
                        '</div>';
            
                var infoWindow = new google.maps.InfoWindow();
                //Attach click event to the marker.
                (function (marker, description) {
                    google.maps.event.addListener(marker, "click", function (e) {
                        //Wrap the content inside an HTML DIV in order to set height and width of InfoWindow.
                        infoWindow.setContent(description);
                        infoWindow.open(map, marker);
                    });

                    google.maps.event.addListener(map, 'click', function() {
                        infoWindow.close();
                    });
                })(marker, description);

            {% endfor %}

        }

    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAa232Ch8q6OuI0qAkNV4s36dSJKSCaswc&callback=initMap" async defer></script>

    {% if is_granted("ROLE_SUPER_ADMIN") %}
        <script>
            $(document).ready(function() {
                $('#example').DataTable( {
                    "language": {
                        "url": "//cdn.datatables.net/plug-ins/1.10.12/i18n/French.json"
                    }
                })
            });
        </script>
        <script type="text/javascript" src=" https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    {% endif %}

{% endblock %}

{% if is_granted("ROLE_SUPER_ADMIN") %}
    {% block stylesheets %}
        {{ parent() }}
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
    {% endblock %}
{% endif %}